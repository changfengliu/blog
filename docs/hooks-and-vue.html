<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Hooks API åœ¨ Vue ä¸­çš„å®ç°åˆ†æ | æˆ‘çš„åšå®¢</title>
    <meta name="description" content="å·¥ç¨‹å¸ˆæ”¹å˜ä¸–ç•Œ">
    
    
    <link rel="preload" href="/blog/assets/css/0.styles.de31820d.css" as="style"><link rel="preload" href="/blog/assets/js/app.bc4ef9f9.js" as="script"><link rel="preload" href="/blog/assets/js/5.144c5385.js" as="script"><link rel="prefetch" href="/blog/assets/js/10.bc45980e.js"><link rel="prefetch" href="/blog/assets/js/11.9ab16bae.js"><link rel="prefetch" href="/blog/assets/js/2.2ce49fe4.js"><link rel="prefetch" href="/blog/assets/js/3.6a70a0b9.js"><link rel="prefetch" href="/blog/assets/js/4.9e475928.js"><link rel="prefetch" href="/blog/assets/js/6.6839bb8b.js"><link rel="prefetch" href="/blog/assets/js/7.67dc841c.js"><link rel="prefetch" href="/blog/assets/js/8.bb74f765.js"><link rel="prefetch" href="/blog/assets/js/9.b7147ea8.js">
    <link rel="stylesheet" href="/blog/assets/css/0.styles.de31820d.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/blog/" class="home-link router-link-active"><!----> <span class="site-name">æˆ‘çš„åšå®¢</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/blog/index.html" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">æ·±å…¥ç†è§£ç³»åˆ—</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://changfengliu.github.io/css-deepen-understanding/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ·±å…¥ç†è§£JavaScript
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://changfengliu.github.io/css-deepen-understanding/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ·±å…¥ç†è§£CSS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://changfengliu.github.io/css-deepen-understanding/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ·±å…¥ç†è§£HTML
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/blog/site/about.html" class="nav-link">About Me</a></div><div class="nav-item"><a href="https://github.com/changfengliu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/blog/index.html" class="nav-link">é¦–é¡µ</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">æ·±å…¥ç†è§£ç³»åˆ—</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://changfengliu.github.io/css-deepen-understanding/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ·±å…¥ç†è§£JavaScript
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://changfengliu.github.io/css-deepen-understanding/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ·±å…¥ç†è§£CSS
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li><li class="dropdown-item"><!----> <a href="https://changfengliu.github.io/css-deepen-understanding/" target="_blank" rel="noopener noreferrer" class="nav-link external">
  æ·±å…¥ç†è§£HTML
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></li></ul></div></div><div class="nav-item"><a href="/blog/site/about.html" class="nav-link">About Me</a></div><div class="nav-item"><a href="https://github.com/changfengliu" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><a href="/blog/hooks-and-vue.html" class="active sidebar-link">Hooks API åœ¨ Vue ä¸­çš„å®ç°åˆ†æ</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/blog/hooks-and-vue.html#hooksè§£å†³äº†ä»€ä¹ˆé—®é¢˜" class="sidebar-link">Hooksè§£å†³äº†ä»€ä¹ˆé—®é¢˜</a></li><li class="sidebar-sub-header"><a href="/blog/hooks-and-vue.html#hooks-æ˜¯ä»€ä¹ˆ" class="sidebar-link">Hooks æ˜¯ä»€ä¹ˆ</a></li><li class="sidebar-sub-header"><a href="/blog/hooks-and-vue.html#hooks-api" class="sidebar-link">Hooks API</a></li></ul></li><li><a href="/blog/old/css-tricks.html" class="sidebar-link">å…³äºCSSä¼ªå…ƒç´ åŠä¼ªç±»çš„ä½¿ç”¨</a></li><li><a href="/blog/old/js-ticker.html" class="sidebar-link">å…³äºWebå‰ç«¯åŸ‹ç‚¹çš„æ€»ç»“</a></li><li><a href="/blog/old/js-array-sort.html" class="sidebar-link">å…³äºJavaScript Array Sortå‡½æ•°çš„å‘</a></li><li><a href="/blog/old/chalk-code.html" class="sidebar-link">å·§å¦™çš„å±æ€§é“¾è°ƒç”¨-Chalkæºç è§£æ</a></li><li><a href="/blog/old/global-image-onerror.html" class="sidebar-link">å¦‚ä½•å…¨å±€å¤„ç†image onerror, æ˜¾ç¤ºé»˜è®¤å›¾ç‰‡</a></li></ul> </div> <div class="page"> <div class="content"><h1 id="hooks-api-åœ¨-vue-ä¸­çš„å®ç°åˆ†æ"><a href="#hooks-api-åœ¨-vue-ä¸­çš„å®ç°åˆ†æ" aria-hidden="true" class="header-anchor">#</a> Hooks API åœ¨ Vue ä¸­çš„å®ç°åˆ†æ</h1> <p>åˆæ¬¡å¬åˆ° React Hooksï¼Œæ˜¯åœ¨å…¶åˆšå‘å¸ƒçš„é‚£å‡ å¤©ï¼Œç½‘ä¸Šé“ºå¤©ç›–åœ°çš„æ–‡ç« ä»‹ç»å®ƒã€‚çœ‹å­—é¢æ„æ€æ˜¯ â€˜React é’©å­â€™ï¼Œå°±æƒ³å½“ç„¶åœ°ç†è§£åº”è¯¥æ˜¯ä¿®æ”¹ React ç»„ä»¶çš„é’©å­å§ã€‚React å»¶ä¼¸çš„æ¦‚å¿µéå¸¸å¤šï¼Œé«˜é˜¶ç»„ä»¶ã€å‡½æ•°å¼ã€Render Propsã€Contextã€ç­‰ç­‰ã€‚åˆæ¥äº†ä¸€ä¸ªæ–°æ¦‚å¿µï¼Œå‰ç«¯å¼€å‘å·²ç»å¤Ÿå¤æ‚äº†ï¼Œæˆ‘å¿ƒé‡Œè¿™æ ·æƒ³ç€ã€‚è¿‘ä¸¤å¹´ä¸€ç›´ç”¨ Vueï¼Œè§‰å¾— React çš„è¯¸å¤šç‰¹æ€§ï¼Œåœ¨ Vue ä¸­ä¹Ÿéƒ½æœ‰ç±»ä¼¼çš„è§£å†³æ–¹æ¡ˆï¼Œæ‰€ä»¥å°±æ²¡æœ‰ç«‹å³å»äº†è§£å®ƒã€‚</p> <p>åæ¥çœ‹åˆ°å°¤å¤§åœ¨<a href="https://www.bilibili.com/video/av36787459/" target="_blank" rel="noopener noreferrer">Vue 3.0 æœ€è¿‘è¿›å±•<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>çš„è§†é¢‘ä¸­ä¹Ÿæåˆ°äº† Hooks APIï¼Œå¹¶å†™äº†ä¸€ä¸ªåœ¨ <a href="https://github.com/yyx990803/vue-hooks" target="_blank" rel="noopener noreferrer">Vue ä¸­ä½¿ç”¨ Hooks çš„ POC<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚çœ‹æ¥ Hooks è¿˜æ˜¯æŒºé‡è¦çš„ï¼Œäºæ˜¯é©¬ä¸Šæ‰¾åˆ° React å®˜æ–¹æ–‡æ¡£ä¸å‘å¸ƒä¼šçš„è§†é¢‘ --- åˆä¸€è½®çš„æ¶è¡¥ã€‚</p> <p>çœ‹äº†ç›¸å…³èµ„æ–™ï¼Œè§‰å¾— Hooks çš„åº”ç”¨å‰æ™¯è¿˜æ˜¯æŒºè¯±äººçš„ï¼Œè§£å†³äº†ç›®å‰å‰ç«¯å¼€å‘ä¸­çš„è¯¸å¤šç—›ç‚¹ã€‚ä¸è¿‡ React Hooks ç›®å‰è¿˜åœ¨ alpha é˜¶æ®µï¼Œä¸å¤ªå®Œå–„ï¼Œå†…ç½® Hooks ä¹Ÿä¸ä¸°å¯Œã€‚è€Œ Vue åªæœ‰ä¸ª Hooks POCï¼ŒVue3.0 å¾ˆå¯èƒ½ä¼šåŠ ä¸Šï¼Œä½†éœ€è¦å†ç­‰å‡ ä¸ªæœˆã€‚æ‰€ä»¥æš‚ä¸å»ºè®®åœ¨æ­£å¼ä»£ç ä¸­ä½¿ç”¨ã€‚</p> <p>æœ¬ç¯‡æ–‡ç« ç€é‡è§£é‡Šä¸€ä¸‹æˆ‘å¯¹ Hooks çš„ç†è§£ï¼Œä»¥åŠ Hooks API åœ¨ Vue ä¸­çš„æºç å®ç°ã€‚ä¹Ÿè¯´æ˜ä¸€ä¸‹ Hooks æ˜¯ä¸ªä¸­ç«‹çš„æ¦‚å¿µï¼Œå¯ä»¥åœ¨ä»»ä½•æ¡†æ¶ä¸­ä½¿ç”¨ï¼Œé React æ‰€ç‹¬æœ‰ ğŸ˜ƒ</p> <h2 id="hooksè§£å†³äº†ä»€ä¹ˆé—®é¢˜"><a href="#hooksè§£å†³äº†ä»€ä¹ˆé—®é¢˜" aria-hidden="true" class="header-anchor">#</a> Hooksè§£å†³äº†ä»€ä¹ˆé—®é¢˜</h2> <p>åœ¨å¼€å§‹ä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆå¤è¿°ä¸€ä¸‹ Hooks ä¼šå¸®æˆ‘ä»¬è§£å†³ä»€ä¹ˆé—®é¢˜ã€‚</p> <p>æŒ‰ç…§ Dan çš„è¯´æ³•ï¼ŒReact é¡¹ç›®çš„å¼€å‘ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªç—›ç‚¹ï¼š</p> <ol><li>è·¨ç»„ä»¶ä»£ç å¤ç”¨é—®é¢˜ã€‚</li> <li>å¤§ç»„ä»¶ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</li> <li>ç»„ä»¶æ ‘å±‚çº§å¾ˆæ·±ã€‚</li> <li>ç±»ç»„ä»¶ä¸å®¹æ˜“ç†è§£ã€‚</li></ol> <p>å½“ç„¶ Vue é¡¹ç›®ä¹Ÿæ˜¯ä¸€æ ·ï¼Œå…¶å®è¿™äº›é—®é¢˜ä¹Ÿæ˜¯ç›¸å…³è”çš„ã€‚</p> <p>ç»„ä»¶åŒ–çš„å¼€å‘æ–¹å¼ï¼Œæˆ‘ä»¬å°†é¡µé¢æ‹†åˆ†æˆä¸åŒçš„ç»„ä»¶ï¼ŒæŒ‰è‡ªä¸Šè€Œä¸‹çš„æ•°æ®æµï¼Œå±‚å±‚åµŒå¥—ã€‚ä»£ç ç»“æ„çš„æœ€å°é¢—ç²’æ˜¯ç»„ä»¶ã€‚</p> <p>å¦‚æœæŸäº›ç»„ä»¶å¤ªå¤§ï¼Œæˆ‘ä»¬å°±ç»§ç»­æ‹†åˆ†æˆæ›´å°çš„ç»„ä»¶ï¼Œç„¶ååœ¨çˆ¶ç»„ä»¶ä¸­è°ƒç”¨å®ƒã€‚
å¦‚æœå¤šç»„ä»¶ä¹‹é—´æœ‰ä¸å°‘é€šç”¨é€»è¾‘ï¼Œæˆ‘ä»¬å°±ç”¨ mixin æˆ– æ„å»ºç»„ä»¶çš„ç»§æ‰¿ä½“ç³»ã€‚</p> <p>ä½†æ˜¯ç»„ä»¶æ‹†åˆ†ï¼Œä¼šä½¿æˆ‘ä»¬å¾ˆå®¹æ˜“ä¸å°å¿ƒå°±æŠŠç»„ä»¶çš„å±‚çº§æå¾—å¾ˆæ·±ï¼Œå¢åŠ ç³»ç»Ÿå¤æ‚åº¦ä¸è¯´ï¼Œæ€§èƒ½ä¹Ÿå¯èƒ½å—åˆ°å½±å“ã€‚å¹¶ä¸”ï¼Œæœ‰äº›ç»„ä»¶çš„äº¤äº’é€»è¾‘ç¡®å®æ¯”è¾ƒå¤æ‚ï¼Œæ‹†åˆ†ä¸å¾—ï¼Œç³»ç»Ÿé•¿æœŸè¿­ä»£ä¸‹æ¥ï¼Œç´¯ç§¯çš„ä»£ç é‡å¾ˆå¤§ï¼Œéš¾ä»¥ç»´æŠ¤ã€‚</p> <p>è·¨ç»„ä»¶é€»è¾‘å¤ç”¨æ›´åŠ æ£˜æ‰‹ï¼mixinæ˜¯ä¸€ä¸ªåŒåˆƒå‰‘(å‚è€ƒï¼š<a href="https://reactjs.org/blog/2016/07/13/mixins-considered-harmful.html" target="_blank" rel="noopener noreferrer">mixin æ˜¯æœ‰å®³çš„<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>)ï¼›ç»„ä»¶ç»§æ‰¿ä¹Ÿä¸å¯å–ï¼Œè™½ç„¶åœ¨å¼ºç±»å‹çš„é¢å‘å¯¹è±¡è¯­è¨€(å¦‚ï¼šJava/C#)ä¸­ï¼Œç»§æ‰¿ç”¨ç€å¾ˆå¥½ï¼Œä½†åœ¨ JavaScript ä¸­æ€»æ„Ÿåˆ°åŠ›ä¸ä»å¿ƒï¼Œä¹Ÿä½¿å¾—ä»£ç æ™¦æ¶©éš¾æ‡‚ï¼›æŠ½å– util åŒ…ä¹Ÿæ˜¯ä¸€ä¸ªæƒ¯ç”¨çš„åšæ³•ï¼Œä½†å¦‚æœè¦æŠ½å–çš„å…¬ç”¨é€»è¾‘éœ€è¦å…³è”ç»„ä»¶çš„æœ¬åœ°çŠ¶æ€å‘¢ï¼Œå¦‚æœç›¸å…³è”çš„å…¬ç”¨é€»è¾‘éœ€è¦åˆ†æ•£åœ¨ç»„ä»¶çš„ä¸åŒç”Ÿå‘½å‘¨æœŸä¸­å‘¢ï¼Œå°±æä¸å®šäº†ï¼è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¾€å¾€å°±å¦¥åäº† --- å¤§ç»„ä»¶/é‡å¤é€»è¾‘äº§ç”Ÿäº†ã€‚</p> <p>ä¸Šæ–‡æåˆ°ç±»ç»„ä»¶çš„é—®é¢˜ï¼Œè™½ç„¶ç”¨é¢å‘å¯¹è±¡çš„æ–¹å¼å»ºæ¨¡ç³»ç»Ÿæ˜¯å¾ˆå¥½çš„åšæ³•ï¼Œä½†æˆ‘ä¸ªäººè§‰å¾—åœ¨ JavaScript ä¸­ï¼Œç‰¹åˆ«æ˜¯åœ¨åŸºäº React/Vue ç»„ä»¶çš„å¼€å‘ä¸­ï¼Œå¹¶ä¸å¾ˆåˆé€‚ï¼Œå¾ˆå®¹æ˜“å‡ºé”™ã€‚æˆ‘ä»¬ç»å¸¸éœ€è¦æŠŠå‡½æ•° bind åˆ°æŸä¸ªä¸Šä¸‹æ–‡ï¼Œä»¥ç¡®ä¿ this çš„æ­£ç¡®æŒ‡å‘ã€‚JavaScript çš„è¯­æ³•è¿‡äºçµæ´»ï¼Œæˆ‘ä»¬çŸ¥é“ JavaScript çš„åŸºäºé™æ€ä½œç”¨åŸŸçš„ï¼Œå°±æ˜¯è¯´ä»æºç ä¸Šçœ‹ï¼Œå°±èƒ½å¤Ÿæ¨æ–­å˜é‡çš„ä½œç”¨åŸŸã€‚ä½† this æ˜¯ä¸ªä¾‹å¤–ï¼Œå®ƒæ˜¯åŸºäºåŠ¨æ€ä½œç”¨åŸŸçš„ï¼Œå°±æ˜¯è¯´ this çš„å€¼æ˜¯ç”±è°ƒç”¨è€…å†³å®šçš„ã€‚åŒä¸€ä¸ªæ–¹æ³•ï¼Œç”¨ä¸åŒçš„æ–¹å¼è°ƒç”¨ï¼Œå…¶ this æŒ‡å‘å®Œå…¨ä¸ä¸€æ ·ã€‚æ„Ÿå…´è¶£çš„åŒå­¦ï¼Œè¯·å‚è€ƒï¼š<a href="http://dmitrysoshnikov.com/ecmascript/chapter-3-this/" target="_blank" rel="noopener noreferrer">è¯¦è§£this<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>ã€‚</p> <p>å¦‚ä½•è§£å†³è¿™äº›ç—›ç‚¹å‘¢ --- Hooks!</p> <h2 id="hooks-æ˜¯ä»€ä¹ˆ"><a href="#hooks-æ˜¯ä»€ä¹ˆ" aria-hidden="true" class="header-anchor">#</a> Hooks æ˜¯ä»€ä¹ˆ</h2> <p>wikipedia ä¸Šå…³äº <a href="https://en.wikipedia.org/wiki/Hooking" target="_blank" rel="noopener noreferrer">hooks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> çš„å®šä¹‰æ˜¯ï¼š</p> <blockquote><p>The term hooking covers a range of techniques used to alter or augment the behavior of an operating system, of applications, or of other software components by intercepting function calls or messages or events passed between software components. Code that handles such intercepted function calls, events or messages is called a hook.</p></blockquote> <p>ç¿»è¯‘æˆä¸­æ–‡å¤§ä½“å«ä¹‰æ˜¯ï¼š</p> <p>Hooks åŒ…å«äº†ä¸€ç³»åˆ—æŠ€æœ¯ï¼Œç”¨äºæ”¹å˜æˆ–å¢å¼ºæ“ä½œç³»ç»Ÿã€åº”ç”¨ç¨‹åºã€è½¯ä»¶ç»„ä»¶çš„è¡Œä¸ºã€‚è¿™äº›æŠ€æœ¯åŒ…æ‹¬æ‹¦æˆªè½¯ä»¶è¿è¡Œè¿‡ç¨‹ä¸­çš„å‡½æ•°è°ƒç”¨ã€æ¶ˆæ¯ã€äº‹ä»¶ã€‚</p> <p>å¯¹åº”åˆ° React/Vue ä¸­ï¼ŒHooks æ˜¯ï¼šå¯ä»¥æ”¹å˜æˆ–å¢å¼º React/Vue ç»„ä»¶åŠŸèƒ½çš„ä»£ç æ¨¡å—ã€‚</p> <p>React ä¸­å¼ºè°ƒ Hooks åªèƒ½åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­ä½¿ç”¨ã€‚æœ¬è´¨ä¸Šå‡½æ•°å¼ç»„ä»¶å°±æ˜¯ä¸€ä¸ªå•çº¯çš„æ¸²æŸ“å‡½æ•°ï¼Œæ¸²æŸ“æ•°æ®æ¥æºäºå¤–éƒ¨ï¼Œç»„ä»¶æœ¬èº«æ— çŠ¶æ€ --- è¿™ä¸ªç»„ä»¶çš„çŠ¶æ€ã€ç”Ÿå‘½å‘¨æœŸä¸­éœ€è¦æ‰§è¡Œçš„é€»è¾‘ä»é‚£é‡Œæ¥å‘¢? --- ç”± hooks æä¾›ã€‚</p> <p>å› æ­¤å¯è§ï¼ŒHooks ä½¿æˆ‘ä»¬æ¨¡å—åŒ–å¼€å‘çš„ç²’åº¦æ›´ç»†äº†ï¼Œæ›´å‡½æ•°å¼äº†ã€‚ç»„ä»¶çš„åŠŸèƒ½å˜æˆäº†ç”± Hooks ä¸€ç‚¹ç‚¹åœ°è£…é…èµ·æ¥ã€‚</p> <h2 id="hooks-api"><a href="#hooks-api" aria-hidden="true" class="header-anchor">#</a> Hooks API</h2> <p>Hooks åº”è¯¥æœ‰èƒ½åŠ›ä¾µå…¥ç»„ä»¶ç”Ÿå‘½å‘¨æœŸçš„æ¯ä¸ªç¯èŠ‚ã€‚React å›¢é˜Ÿä¹Ÿå¸Œæœ›æœªæ¥ 'å‡½æ•°å¼ç»„ä»¶ + Hooks' æˆä¸ºå¼€å‘ç»„ä»¶çš„ä¸»è¦æ–¹å¼ã€‚ç›®å‰ React æä¾›çš„ Hooks è¿˜ä¸å¤Ÿä¸°å¯Œï¼Œåç»­ä¼šé€æ¸å®Œå–„ã€‚</p> <p>è¿™é‡Œç»“åˆ React Hooks API ä¸ <a href="https://github.com/yyx990803/vue-hooks" target="_blank" rel="noopener noreferrer">å°¤å¤§çš„Hooks POC of Vue<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> åˆ†æä¸€ä¸‹ Hooks API åœ¨ Vue ä¸­çš„å®ç°ã€‚</p> <blockquote><p>React Hooks åªåœ¨ alpha é˜¶æ®µï¼Œè€Œ Vue åªæ˜¯æœ‰ä¸ª Hooks POCï¼Œç›®å‰è¿™ç§æœºåˆ¶è¿˜å¾ˆä¸å®Œå–„ï¼Œä¸å»ºè®®åœ¨æ­£å¼ä»£ç ä¸­ä½¿ç”¨ã€‚ä½† Hooks å¸¦æ¥çš„åº”ç”¨å‰æ™¯éå¸¸è¯±äººï¼Œè¿™é‡Œåˆ†æ Hooks çš„ Vue å®ç°æ˜¯ä¸ºäº†æ›´å¥½åœ°ç†è§£ Hooksï¼Œä»¥åŠè¯´æ˜ Hooks æ˜¯ä¸ªä¸­ç«‹çš„æ¦‚å¿µï¼Œé React æ‰€ç‹¬æœ‰(Vue3.0 å¾ˆå¯èƒ½ä¼šåŠ ä¸Šï¼Œä½†éœ€è¦å†ç­‰å‡ ä¸ªæœˆ)ã€‚</p></blockquote> <h3 id="usestate"><a href="#usestate" aria-hidden="true" class="header-anchor">#</a> useState</h3> <p>å¯ä»¥ä¸ºç»„ä»¶æ·»åŠ ä¸€ä¸ªå“åº”å¼çš„æœ¬åœ°çŠ¶æ€ï¼ŒåŠè¯¥çŠ¶æ€ç›¸å…³çš„æ›´æ–°å™¨ã€‚</p> <p>æ–¹æ³•ç­¾åä¸ºï¼š</p> <blockquote><p>const [state, setState] = useState(initialState);</p></blockquote> <p>setState ç”¨äºæ›´æ–°çŠ¶æ€ï¼š</p> <blockquote><p>setState(newState);</p></blockquote> <p>Vue ä¸­å®ç° useState:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useState</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">ensureCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token operator">++</span>callIndex
  <span class="token comment">// è·å–ç»„ä»¶å®ä¾‹çš„æœ¬åœ°çŠ¶æ€ã€‚</span>
  <span class="token keyword">const</span> state <span class="token operator">=</span> currentInstance<span class="token punctuation">.</span>$data<span class="token punctuation">.</span>_state
  <span class="token comment">// æœ¬åœ°çŠ¶æ€æ›´æ–°å™¨ï¼Œä»¥è‡ªå¢idä¸ºé”®å€¼ï¼Œå­˜å‚¨åˆ°æœ¬åœ°çŠ¶æ€ä¸­ã€‚</span>
  <span class="token keyword">const</span> <span class="token function-variable function">updater</span> <span class="token operator">=</span> newValue <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    state<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> newValue
  <span class="token punctuation">}</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMounting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// é€šè¿‡$setä¿è¯å…¶æ˜¯å“åº”å¼çŠ¶æ€ã€‚</span>
    currentInstance<span class="token punctuation">.</span>$<span class="token keyword">set</span><span class="token punctuation">(</span>state<span class="token punctuation">,</span> id<span class="token punctuation">,</span> initial<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// è¿”å›å“åº”å¼çŠ¶æ€ä¸æ›´æ–°å™¨ã€‚</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span>state<span class="token punctuation">[</span>id<span class="token punctuation">]</span><span class="token punctuation">,</span> updater<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä»¥ä¸Šä»£ç å¾ˆæ¸…æ™°åœ°æè¿°äº† useState æ˜¯åœ¨ç»„ä»¶ä¸­åˆ›å»ºäº†ä¸€ä¸ªæœ¬åœ°çš„å“åº”å¼çŠ¶æ€ï¼Œå¹¶ç”Ÿæˆäº†ä¸€ä¸ªçŠ¶æ€æ›´æ–°å™¨ã€‚</p> <p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼š</p> <ol><li>å‡½æ•° ensureCurrentInstance æ˜¯ä¸ºäº†ç¡®ä¿ useState å¿…é¡»åœ¨ render ä¸­æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯é™åˆ¶äº†å¿…é¡»åœ¨å‡½æ•°å¼ç»„ä»¶ä¸­æ‰§è¡Œã€‚</li> <li>ä»¥ callIndex ç”Ÿæˆçš„è‡ªå¢idä½œä¸ºå­˜å‚¨çŠ¶æ€å€¼çš„keyã€‚è¯´æ˜ useState éœ€è¦ä¾èµ–ç¬¬ä¸€æ¬¡æ¸²æŸ“æ—¶çš„è°ƒç”¨é¡ºåºæ¥åŒ¹é…è¿‡å»çš„ stateï¼ˆæ¯æ¬¡æ¸²æŸ“ callIndex ä¸ºé‡ç½®ä¸º0ï¼‰ã€‚è¿™ä¹Ÿé™åˆ¶äº† useState å¿…é¡»åœ¨é¡¶å±‚ä»£ç ä¸­ä½¿ç”¨ã€‚</li> <li>å…¶å®ƒ hooks ä¹Ÿå¿…é¡»éµå¾ªä»¥ä¸Šä¸¤ç‚¹ã€‚</li></ol> <h3 id="useeffect"><a href="#useeffect" aria-hidden="true" class="header-anchor">#</a> useEffect</h3> <p>useEffect æ˜¯ä¸ºäº†åœ¨ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸä¸­ï¼Œæ‰§è¡Œä¸€äº›å¸¦æœ‰å‰¯ä½œç”¨çš„é€»è¾‘ã€‚</p> <p>æ–¹æ³•ç­¾åï¼š</p> <blockquote><p>void useEffect(rawEffect, deps);</p></blockquote> <p>Vue ä¸­å®ç° useEffect:</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useEffect</span><span class="token punctuation">(</span>rawEffect<span class="token punctuation">,</span> deps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">ensureCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token operator">++</span>callIndex
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMounting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> <span class="token function-variable function">cleanup</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> current <span class="token punctuation">}</span> <span class="token operator">=</span> cleanup
      <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
        cleanup<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">const</span> <span class="token function-variable function">effect</span> <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">const</span> <span class="token punctuation">{</span> current <span class="token punctuation">}</span> <span class="token operator">=</span> effect
      <span class="token keyword">if</span> <span class="token punctuation">(</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        cleanup<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token function">current</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment">// rawEffectçš„è¿”å›å€¼ï¼Œå¦‚æœæ˜¯ä¸€ä¸ªå‡½æ•°çš„è¯ï¼Œåˆ™å®šä¹‰ä¸ºuseEffectå‰¯ä½œç”¨çš„æ¸…ç†å‡½æ•°ã€‚</span>
        effect<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    effect<span class="token punctuation">.</span>current <span class="token operator">=</span> rawEffect
    <span class="token comment">// åœ¨ç»„ä»¶å®ä¾‹ä¸Šï¼Œå­˜å‚¨useEffectç›¸å…³é€»è¾‘ã€‚</span>
    currentInstance<span class="token punctuation">.</span>_effectStore<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      effect<span class="token punctuation">,</span>
      cleanup<span class="token punctuation">,</span>
      deps
    <span class="token punctuation">}</span>
    <span class="token comment">// ç»„ä»¶å®ä¾‹mountedæ—¶ï¼Œæ‰§è¡ŒuseEffecté€»è¾‘ã€‚</span>
    currentInstance<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'hook:mounted'</span><span class="token punctuation">,</span> effect<span class="token punctuation">)</span>
    <span class="token comment">// ç»„ä»¶å®ä¾‹destroyedæ—¶ï¼Œæ‰§è¡ŒuseEffectç›¸å…³æ¸…ç†é€»è¾‘ã€‚</span>
    currentInstance<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'hook:destroyed'</span><span class="token punctuation">,</span> cleanup<span class="token punctuation">)</span>
    <span class="token comment">// è‹¥æœªæŒ‡å®šä¾èµ–é¡¹æˆ–å­˜åœ¨æ˜ç¡®çš„ä¾èµ–é¡¹æ—¶ï¼Œå½“ç»„ä»¶å®ä¾‹updatedæ—¶ï¼Œæ‰§è¡ŒuseEffecté€»è¾‘ã€‚</span>
    <span class="token comment">// è‹¥æŒ‡å®šä¾èµ–é¡¹ä¸º [], åˆ™useEffectåªåœ¨mountedæ—¶æ‰§è¡Œä¸€æ¬¡ã€‚</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deps <span class="token operator">||</span> deps<span class="token punctuation">.</span>length <span class="token operator">&gt;</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      currentInstance<span class="token punctuation">.</span><span class="token function">$on</span><span class="token punctuation">(</span><span class="token string">'hook:updated'</span><span class="token punctuation">,</span> effect<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token keyword">const</span> record <span class="token operator">=</span> currentInstance<span class="token punctuation">.</span>_effectStore<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
    <span class="token keyword">const</span> <span class="token punctuation">{</span> effect<span class="token punctuation">,</span> cleanup<span class="token punctuation">,</span> deps<span class="token punctuation">:</span> prevDeps <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span> <span class="token punctuation">}</span> <span class="token operator">=</span> record
    record<span class="token punctuation">.</span>deps <span class="token operator">=</span> deps
    <span class="token keyword">if</span> <span class="token punctuation">(</span><span class="token operator">!</span>deps <span class="token operator">||</span> deps<span class="token punctuation">.</span><span class="token function">some</span><span class="token punctuation">(</span><span class="token punctuation">(</span>d<span class="token punctuation">,</span> i<span class="token punctuation">)</span> <span class="token operator">=&gt;</span> d <span class="token operator">!==</span> prevDeps<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// ä¾èµ–çš„çŠ¶æ€å€¼æœ‰å˜åŠ¨æ—¶ï¼Œæ¸…ç†useEffectçš„å‰¯ä½œç”¨å¹¶é‡æ–°æ‰§è¡Œã€‚</span>
      <span class="token function">cleanup</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token comment">// useEffect æ‰§è¡Œå®Œæ¯•åï¼Œä¼šå°† current çš„å±æ€§ç½®ä¸º null. è¿™é‡Œå°† current çš„å€¼è®¾ç½®ä¸º rawEffectï¼Œ</span>
      <span class="token comment">// æ˜¯ä¸ºäº†åœ¨ updated æ—¶æ‰§è¡Œ useEffect é€»è¾‘ã€‚</span>
      effect<span class="token punctuation">.</span>current <span class="token operator">=</span> rawEffect
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>å¯ä»¥çœ‹åˆ° useEffect æ‰€æŒ‡å®šçš„å‰¯ä½œç”¨é€»è¾‘ï¼Œä¼šåœ¨ç»„ä»¶çš„ mountedã€updatedã€destroyed ä¸‰ä¸ªæ—¶æœŸæ‰§è¡Œã€‚æ‰§è¡Œçš„ç»†èŠ‚ç”± deps æ§åˆ¶ã€‚</p> <p>éœ€è¦æ³¨æ„ï¼š</p> <ol><li>å¦‚æœ deps ä¸º null/undefinedï¼Œåˆ™å‰¯ä½œç”¨é€»è¾‘åœ¨æ¯æ¬¡æ¸²æŸ“éƒ½ä¼šæ‰§è¡Œã€‚</li> <li>å¦‚æœ deps æŒ‡å®šäº†ä¾èµ–çš„çŠ¶æ€ï¼Œåˆ™ç›¸åº”çŠ¶æ€æ”¹å˜æ—¶ï¼Œä¼šæ‰§è¡Œå‰¯ä½œç”¨é€»è¾‘ã€‚</li> <li>å¦‚æœ deps æŒ‡å®šä¸º []ï¼Œåˆ™å‰¯ä½œç”¨é€»è¾‘ä»…ä¼šåœ¨ mounted æ—¶æ‰§è¡Œã€‚</li> <li>æ¯æ¬¡éœ€è¦æ‰§è¡Œå‰¯ä½œç”¨é€»è¾‘æ—¶ï¼Œéƒ½ä¼šå…ˆæ‰§è¡Œæ¸…ç†é€»è¾‘ -- rawEffect çš„è¿”å›å€¼ã€‚</li> <li>ç»„ä»¶ destroyed æ—¶ï¼Œä¼šæ‰§è¡Œæ¸…ç†é€»è¾‘ã€‚</li></ol> <h3 id="useref"><a href="#useref" aria-hidden="true" class="header-anchor">#</a> useRef</h3> <p>ç›¸å½“äºä¸ºç»„ä»¶å­˜å‚¨ä¸€ä¸ªæœ¬åœ°å˜é‡ --- éçŠ¶æ€ã€‚</p> <p>æ–¹æ³•ç­¾åï¼š</p> <blockquote><p>const refContainer = useRef(initialValue)</p></blockquote> <p>Vue ä¸­ useRef çš„å®ç°ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useRef</span><span class="token punctuation">(</span>initial<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">ensureCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token operator">++</span>callIndex
  <span class="token keyword">const</span> <span class="token punctuation">{</span> _refsStore<span class="token punctuation">:</span> refs <span class="token punctuation">}</span> <span class="token operator">=</span> currentInstance
  <span class="token keyword">return</span> isMounting <span class="token operator">?</span>
    <span class="token punctuation">(</span>refs<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      current<span class="token punctuation">:</span> initial
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token punctuation">:</span>
    refs<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><h3 id="usemounted"><a href="#usemounted" aria-hidden="true" class="header-anchor">#</a> useMounted</h3> <p>æ·»åŠ éœ€è¦åœ¨ mounted äº‹ä»¶ä¸­æ‰§è¡Œçš„é€»è¾‘ã€‚</p> <p>Vue ä¸­ useMounted çš„å®ç°ï¼š</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useMounted</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é€šè¿‡ useEffect å®ç°ï¼Œå¦‚æœ deps çš„å€¼ä¸ºç©ºçš„è¯ï¼Œfn å°±ä¸åœ¨ updated ä¸­æ‰§è¡Œäº† --- å³ä»…åœ¨ mounted æ—¶æ‰§è¡Œä¸€æ¬¡.</p> <h3 id="usedestroyed"><a href="#usedestroyed" aria-hidden="true" class="header-anchor">#</a> useDestroyed</h3> <p>æ·»åŠ éœ€è¦åœ¨ destroyed é˜¶æ®µæ‰§è¡Œçš„é€»è¾‘ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useDestroyed</span><span class="token punctuation">(</span>fn<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> fn<span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ä¸Šé¢æåˆ° useEffect çš„å‰¯ä½œç”¨é€»è¾‘çš„è¿”å›å€¼ï¼Œå¦‚æœæ˜¯å‡½æ•°çš„è¯ï¼Œä¼šåœ¨ destroyed é˜¶æ®µä½œä¸ºæ¸…ç†é€»è¾‘æ‰§è¡Œã€‚
è¿™é‡Œé€šè¿‡è®¾ç½® deps çš„å€¼ä¸º[]ï¼Œå¹¶æŠŠ fn æŒ‡å®šä¸º useEffect çš„å‰¯ä½œç”¨é€»è¾‘çš„è¿”å›å€¼ï¼Œä½¿ fn åœ¨ destroyed é˜¶æ®µæ‰§è¡Œã€‚</p> <h3 id="useupdated"><a href="#useupdated" aria-hidden="true" class="header-anchor">#</a> useUpdated</h3> <p>æ·»åŠ åªåœ¨ç»„ä»¶æ›´æ–°åæ‰§è¡Œçš„é€»è¾‘ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useUpdated</span><span class="token punctuation">(</span>fn<span class="token punctuation">,</span> deps<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">const</span> isMount <span class="token operator">=</span> <span class="token function">useRef</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span>  <span class="token comment">// é€šè¿‡ useRef ç”Ÿæˆä¸€ä¸ªæ ‡è¯†ç¬¦ã€‚</span>
  <span class="token function">useEffect</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>isMount<span class="token punctuation">.</span>current<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      isMount<span class="token punctuation">.</span>current <span class="token operator">=</span> <span class="token boolean">false</span> <span class="token comment">// è·³è¿‡ mounted.</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span> deps<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre></div><p>é€šè¿‡ useEffect å®ç°ï¼Œfn å®šä¹‰åœ¨äº†æ¸…ç†é€»è¾‘çš„ä½ç½®ï¼Œæ¯æ¬¡ç»„ä»¶æ›´æ–°éƒ½ä¼šæ‰§è¡Œï¼Œè¯¦ç»†è¯·å‚è€ƒ useEffect çš„å®ç°ç»†èŠ‚ã€‚</p> <h3 id="usewatch"><a href="#usewatch" aria-hidden="true" class="header-anchor">#</a> useWatch</h3> <p>ä¸ºç»„ä»¶æ·»åŠ  watch.</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useWatch</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">ensureCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMounting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    currentInstance<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>getter<span class="token punctuation">,</span> cb<span class="token punctuation">,</span> options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>ç›´æ¥é€šè¿‡ç»„ä»¶å®ä¾‹çš„ $watch å®ç°ã€‚</p> <h3 id="usecomputed"><a href="#usecomputed" aria-hidden="true" class="header-anchor">#</a> useComputed</h3> <p>ä¸ºç»„ä»¶æ·»åŠ  computed å±æ€§ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">useComputed</span><span class="token punctuation">(</span>getter<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">ensureCurrentInstance</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">const</span> id <span class="token operator">=</span> <span class="token operator">++</span>callIndex
  <span class="token keyword">const</span> store <span class="token operator">=</span> currentInstance<span class="token punctuation">.</span>_computedStore
  <span class="token keyword">if</span> <span class="token punctuation">(</span>isMounting<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    store<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">getter</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    currentInstance<span class="token punctuation">.</span><span class="token function">$watch</span><span class="token punctuation">(</span>
      getter<span class="token punctuation">,</span>
      val <span class="token operator">=&gt;</span> <span class="token punctuation">{</span>
        store<span class="token punctuation">[</span>id<span class="token punctuation">]</span> <span class="token operator">=</span> val
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
      <span class="token punctuation">{</span>
        sync<span class="token punctuation">:</span> <span class="token boolean">true</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> store<span class="token punctuation">[</span>id<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>æœ¬è´¨ä¸Šä¹Ÿæ˜¯é€šè¿‡ç»„ä»¶å®ä¾‹çš„ $watch å®ç°ã€‚</p> <h3 id="åŒ…è£…å‡½æ•°å¼ç»„ä»¶"><a href="#åŒ…è£…å‡½æ•°å¼ç»„ä»¶" aria-hidden="true" class="header-anchor">#</a> åŒ…è£…å‡½æ•°å¼ç»„ä»¶</h3> <p>æŠŠæŒ‡å®šçš„æ¸²æŸ“å‡½æ•°å°è£…æˆ Vue ç»„ä»¶ã€‚</p> <div class="language-javascript extra-class"><pre class="language-javascript"><code><span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">withHooks</span><span class="token punctuation">(</span>render<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">{</span>
    <span class="token function">data</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> <span class="token punctuation">{</span>
        _state<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>  <span class="token comment">// å­˜å‚¨ hook state.</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">created</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token comment">// å­˜å‚¨ hooks ç›¸å…³è¾…åŠ©å˜é‡ã€‚</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_effectStore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_refsStore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
      <span class="token keyword">this</span><span class="token punctuation">.</span>_computedStore <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">)</span> <span class="token punctuation">{</span>
      callIndex <span class="token operator">=</span> <span class="token number">0</span> <span class="token comment">// é‡ç½®ç´¢å¼•ï¼Œä»¥ä¾¿æ ¹æ®è°ƒç”¨æ¬¡åºåŒ¹é…å¯¹åº”çš„ hooks.</span>
      currentInstance <span class="token operator">=</span> <span class="token keyword">this</span>  <span class="token comment">// å½“å‰ç»„ä»¶å®ä¾‹</span>
      isMounting <span class="token operator">=</span> <span class="token operator">!</span><span class="token keyword">this</span><span class="token punctuation">.</span>_vnode <span class="token comment">// æ ‡è¯†ç»„ä»¶çš„æŒ‚è½½çŠ¶æ€ã€‚</span>
      <span class="token keyword">const</span> ret <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>h<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$attrs<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">.</span>$props<span class="token punctuation">)</span> <span class="token comment">// æ¸²æŸ“</span>
      currentInstance <span class="token operator">=</span> <span class="token keyword">null</span>
      <span class="token keyword">return</span> ret
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Vue ä¸­å‡½æ•°å¼ç»„ä»¶ä¸å¤šè§ï¼Œè¿™é‡Œæ˜¯ä¸ºäº†æ¨¡æ‹Ÿ React çš„å‡½æ•°å¼ç»„ä»¶ã€‚</p> <p>æœ¬è´¨ä¸Šå‡½æ•°å¼ç»„ä»¶å°±æ˜¯ä¸€ä¸ªæ¸²æŸ“å‡½æ•°ï¼Œåªè´Ÿè´£æ¸²æŸ“ï¼Œæ¸²æŸ“æ•°æ®æ¥æºäºå¤–éƒ¨ï¼Œæœ¬èº«æ— çŠ¶æ€ --- ç›¸å½“äºèµ¤è£¸è£¸çš„ç»„ä»¶ã€‚å®ƒçš„çŠ¶æ€ã€ç”Ÿå‘½å‘¨æœŸä¸­éœ€è¦æ‰§è¡Œçš„é€»è¾‘ä»é‚£é‡Œæ¥å‘¢? --- ç”± hooks æä¾›ã€‚</p> <p>å› æ­¤æ›´ç›´è§‚åœ°è¯´æ˜äº†ï¼Œhooksä½¿æˆ‘ä»¬æ¨¡å—åŒ–çš„å¼€å‘ç²’åº¦æ›´ç»†äº†ï¼Œæ›´å‡½æ•°å¼äº†ã€‚ç»„ä»¶çš„åŠŸèƒ½å˜æˆäº†ç”± hooks ä¸€ç‚¹ç‚¹åœ°è£…é…èµ·æ¥ã€‚</p> <p>å®Œæ•´ä»£ç åŠç¤ºä¾‹è¯·å‚è€ƒï¼š<a href="https://github.com/yyx990803/vue-hooks" target="_blank" rel="noopener noreferrer">POC of vue-hooks<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></p></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/blog/old/css-tricks.html">
          å…³äºCSSä¼ªå…ƒç´ åŠä¼ªç±»çš„ä½¿ç”¨
        </a>
        â†’
      </span></p></div> </div> <!----></div></div>
    <script src="/blog/assets/js/app.bc4ef9f9.js" defer></script><script src="/blog/assets/js/5.144c5385.js" defer></script>
  </body>
</html>
